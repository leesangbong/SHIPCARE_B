<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <meta charset="utf-8" />

    <!-- js css primary-->

    <script src="dist/jquery/jquery-2.1.4.min.js"></script>
    <script src="dist/semantic/semantic.min.js"></script>
    <link rel="stylesheet" href="dist/semantic/semantic.min.css" />
    <script src="Geojson/mock_shipposition.js"></script>

    <!-- js css primary End-->
    <!-- js css secondary-->
    <style>
        pre.ui-coordinates {
            background: rgba(0,0,0,0.5);
            position: absolute;
            bottom: 35px;
            left: 10px;
            padding: 5px 10px;
            color: #fff;
            font-size: 11px;
            line-height: 18px;
            border-radius: 3px;
            max-height: 200px;
            overflow: auto;
            width: 200px;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .position {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
        }

        .position1 {
            position: absolute;
            bottom: 1em;
            left: 0.5em;
            opacity: 0.9;
        }

        #push {
            position: absolute;
          
            height: calc(100% - 4.8em);
            padding: 0;
            margin: 0;
            top: 3.0em;
            bottom: 2.8em;
        }

        /* sidebarnav_icon position End */
    </style>
    <script src="dist/Script/HomePage_load.js"></script>
    <link rel="stylesheet" type="text/css" href="dist/semantic/components/sidebar.css">
    <!-- js css secondary End-->
    <!-- js css sub-->
    <link rel="stylesheet" href="dist/kendo/styles/kendo.common.min.css" />
    <link rel="stylesheet" href="dist/kendo/styles/kendo.default.min.css" />
    <script src="dist/kendo/js/kendo.all.min.js"></script>

    <script src='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
    <script src="dist/Script/iconLayers.js"></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
    <link href="dist/Script/iconLayers.css" rel="stylesheet" />

    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
    <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
    <script src="Geojson/mock_shipposition.js"></script>
    <script src="Geojson/treemenu.js"></script>
    <!-- js css sub End-->
</head>

<body>

    <!-- Header -->
    <header class="ui inverted top fixed menu">
        <a id="sidebar_onoff_btn" class="item">
            <i class="sidebar icon"></i>
            SHIP
        </a>
        <div class="ui icon input">
            <input type="text" style="background-color:gainsboro; border-radius:0; width:260px;" placeholder="Search..." /><i class="search icon"></i>
        </div>

        <!-- Topnav -->
        <a name="topnavmain" href="HomePage_Main.html" id="homeicon" class="item active current"><i class="home icon"></i></a>
        <a name="topnav" href="ShipInput_Home_testPage.html" class="item"><i class="edit icon"></i></a>
        <a name="topnav" href="ReportingSystem_TestPage1.html" class="item"><i class="paste icon"></i></a>
        <a name="topnav" href="center_4.html" class="item"><i class="search icon"></i></a>
        <a name="topnav" href="center_5.html" class="item"><i class="comments outline icon"></i></a>
        <!-- Topnav End-->

        <div class="right menu">
            <div class="ui feed">
                <div class="event">
                    <div class="label" style="position:relative; top:5px; left:12px;">
                        <!-- 상단 ui feed~label까지 ㅁ→-->
                        <img src="dist/images/userpic/helen.jpg">
                    </div>
                    <div class="content">
                        <div class="summary" style="color:white;">
                            Hong Gil-Dong&nbsp;&nbsp;/&nbsp;&nbsp;Access Time 02:35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </div>
                        <div class="date" style="color:white;">
                            honggildong@gmail.com&nbsp;&nbsp;&nbsp;&nbsp;
                            <a style="position:relative; top:2px;">
                                <i class="power icon" style="position:relative; top:1px; left:4px;"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!--<a class="item"><i class="trash icon"></i></a>
            <a class="item"><i class="save icon"></i></a>-->
        </div>
    </header>
    <!-- Header End-->
    <!-- sidebarnav -->
    <div id="push" class="ui attached segment pushable" style="position:absolute; left:-1px;">
        <div class="ui sidebar vertical menu">
            <!-- class = "ui labeled icon left inline vertical sidebar menu" <original>-->
            <div id="treeview"></div>
        </div>

        <!-- center -->
        <div id="center_primary">
            <div id="center_secondary" class="pusher">
                <div id='map'></div>
                <pre id='coordinates' class='ui-coordinates position1'></pre>
                <div id='info' class="position"></div>
                <div id="btn_info" class="position"></div>
                <div class="position1">
                    <div class='ui label black'>
                        <i class="world icon"></i>
                        <code id="mousemove"></code><br />
                    </div>
                </div>
            </div>
        </div>
        <!-- center End-->
    </div>
    <!-- sidebarnav End -->
    <!-- Footer -->
    <div class="ui bottom fixed  menu" style="height:21px;">
        <a class="item"><i class="sidebar icon"></i></a>
        <a class="item">Features</a>
        <a class="item">Testimonials</a>
        <a class="item">Sign-in</a>

        <div class="right menu" style="padding-top:4px;">
            <i class="caret up icon"></i>&nbsp;&nbsp;
            <i class="send icon"></i>&nbsp;&nbsp;
            <i class="signal icon"></i>&nbsp;&nbsp;
            <i class="alarm icon"></i>&nbsp;&nbsp;
            오후&nbsp;&nbsp;6:35&nbsp;&nbsp;&nbsp;2015-08-04&nbsp;&nbsp;&nbsp;
        </div>
    </div>
    <!-- Footer End -->

    <script>

        $('#btn_info').on('click', (function () {
            $('.shape').shape('flip right');
        }));

        // 맵세팅
        L.mapbox.accessToken = 'pk.eyJ1IjoibGFiMDIxIiwiYSI6ImQwMjdmMDlhNzBmMTRmYTY3MDFhZjZiYmNkZDI0MWRhIn0.L5TmPocGj72LszJ3mDOAiQ';
        var map = L.mapbox.map('map', null, {
            attributionControl: false,
            worldCopyJump: false,
            minZoom: 3,
            maxZoom: 17,
            zoomControl: false
        }).setView([40, 155], 3).addControl(L.mapbox.geocoderControl('mapbox.places', {
            autocomplete: true
        }));

        // 축척
        L.control.scale({ position: 'bottomright' }).addTo(map);

        // 맵줌 컨트롤러 오른쪽으로 이동
        new L.Control.Zoom({ position: 'topleft' }).addTo(map);

        var ships = new L.MarkerClusterGroup({
            disableClusteringAtZoom: 10,
            maxClusterRadius: 50
        });


        //선박 마커 띄우기
        var shipTypes = ['Oil Carrier', 'Container', 'Bulk Carrier', 'Car Carrier', 'Carrier'];

        ships.addLayers(ship_data.map(function (ship) {
            return new L.Marker(new L.LatLng(ship[1], ship[2]), {
                draggable: true,
                title: ship[0],
                shipname: ship[4],
                icon: L.icon({
                    iconSize: [20, 23],
                    iconAnchor: [0, 0],
                    popupAnchor: [0, 0],
                    iconUrl: '/dist/images/marker' + ship[3] + '.png'
                })
            }).on('mouseover', function (e) {

                info.innerHTML = "";
                var marker_title = this.options.title;

                $("img[title=" + marker_title + "]").popup({
                    html: "<div class='header'>" + "M/V " + ship[4] + "</div><div class='content'><div class='ui star rating'><i class='active icon'></i><i class='active icon'></i><i class='active icon'></i><i class='icon'></i><i class='icon'></i></div></div>"
                }).popup('toggle');

                var content = '<div class="ui people shape"><div class="sides"><div class="side"><div class="ui card"><div class="image"><img src="/dist/images/ship1.jpg"></div><div class="content"><div class="header">' + 'M/V ' + ship[4] + ' - ' + shipTypes[ship[3]] + '</div><div class="meta"><a>STX 마린서비스</a></div><div class="description"><p>SPEED : 14.1Knots </p><p>FOC(Day) : 40.5M/T</p><p>RPM : 65.3</p><p>ETA : 2015.08.07 12:34</p></div></div><div class="extra content"><span class="right floated">Last Dock : 2014.05.18</span><span><i class="user icon"></i>PIC : 전경환</span></div></div></div><div class="side active"><div class="ui card"><div class="image"><img src="/dist/images/ship2.jpg"></div><div class="content"><a class="header">' + 'M/V ' + ship[4] + ' - ' + shipTypes[ship[3]] + '</a><div class="meta"><span class="date">Last Dock : 2014.05.03</span></div><div class="description"><p>SPEDD LOSS : 1.53Knots (5.65%)</p><p>FOC증가율 : 4.5M/T (6.74%)</p><p>M/E Torque rich : 2.56%</p><p>에너지관리상태 : 매우 양호</p></div></div><div class="extra content"><a><i class="user icon"></i>PIC : 전경환 과장</a></div></div></div></div></div>';

                info.innerHTML = content;
                btn_info.innerHTML = '<button class="mini ui icon button" style="position:absolute; right: -3px;" ><i class="icon arrow right"></i></button>';

            }).on('click', function (e) {

                info.innerHTML = "";
            })

        }));
        map.addLayer(ships);

        map.on('click', function (e) {
            info.innerHTML = "";
            btn_info.innerHTML = "";
        })

        // 날씨오버레이_중첩가능
        var weather_overlays = {
            Enc: L.tileLayer('http://wms.transas.com/TMS/1.0.0/TX97/{z}/{x}/{y}.png?token=7d6b0e2c-3684-40de-8b8c-c50deea14231', { tms: true, maxZoom: 17, opacity: 0.7 }),
            Enc_night: L.tileLayer('http://wms.transas.com/TMS/1.0.0/tx97-night/{z}/{x}/{y}.png?token=7d6b0e2c-3684-40de-8b8c-c50deea14231', { tms: true, maxZoom: 17 })
           ,

            precipitation: L.tileLayer('http://{s}.tile.openweathermap.org/map/precipitation/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            wind: L.tileLayer('http://{s}.tile.openweathermap.org/map/wind/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            rain: L.tileLayer('http://{s}.tile.openweathermap.org/map/rain/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            snow: L.tileLayer('http://{s}.tile.openweathermap.org/map/snow/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            clouds: L.tileLayer('http://{s}.tile.openweathermap.org/map/clouds/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            pressure: L.tileLayer('http://{s}.tile.openweathermap.org/map/pressure/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            pressure_cntr: L.tileLayer('http://{s}.tile.openweathermap.org/map/pressure_cntr/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            }),
            temperature: L.tileLayer('http://{s}.tile.openweathermap.org/map/temp/{z}/{x}/{y}.png', {
                maxZoom: 17,
                opacity: 0.4
            })

        };

        var map_layers = {};

        map_layers['Satellite'] = {
            title: 'Satellite',
            icon: 'dist/images/1.jpg',
            layer: L.mapbox.tileLayer('mapbox.streets-satellite')
        },

        map_layers['Streets'] = {
            title: 'Streets',
            icon: 'dist/images/2.jpg',
            layer: L.mapbox.tileLayer('mapbox.streets')
        },

        map_layers['Contrast'] = {
            title: 'Contrast',
            icon: 'dist/images/3.jpg',
            layer: L.mapbox.tileLayer('mapbox.high-contrast')
        },

        map_layers['Dark'] = {
            title: 'Dark',
            icon: 'dist/images/4.jpg',
            layer: L.mapbox.tileLayer('mapbox.dark')
        },

        map_layers['Emerald'] = {
            title: 'Emerald',
            icon: 'dist/images/5.jpg',
            layer: L.mapbox.tileLayer('mapbox.emerald')
        },

        map_layers['Pirates'] = {
            title: 'Pirates',
            icon: 'dist/images/6.jpg',
            layer: L.mapbox.tileLayer('mapbox.pirates')
        },

         map_layers['Ocean map'] = {

             title: 'Ocean map',
             icon: 'dist/images/7.jpg',
             layer: L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}', {
                 attribution: 'Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri',
                 maxZoom: 13
             })
         },

        map_layers['S57-ENC'] = {
            title: 'S57-ENC',
            icon: 'dist/images/8.jpg',
            layer: L.tileLayer('http://wms.transas.com/TMS/1.0.0/TX97/{z}/{x}/{y}.png?token=7d6b0e2c-3684-40de-8b8c-c50deea14231', { tms: true, maxZoom: 17 })

        };

        var layers = [];

        for (var map_layersId in map_layers) {
            layers.push(map_layers[map_layersId]);
        }
        var ctrl = L.control.iconLayers(layers, { position: 'bottomright', maxLayersInRow: 4 }).addTo(map);
        map_layers['Satellite'].layer.addTo(map); // 첫맵 선택
        L.control.layers("", weather_overlays, { autoZIndex: true, position: 'bottomright' }).addTo(map);      // 맵, 날씨 선택컨트롤러

        var mousemove = document.getElementById('mousemove');

        map.on('mousemove', function (e) {
            var lat_array;
            var lng_array;
            var lat_temp;
            var lng_temp;
            lat_array = e.latlng.lat.toFixed(5).split('.');
            if (e.latlng.lat > 0) {
                lat_temp = e.latlng.lat;
                lat_array = lat_temp.toFixed(5).split('.');
                lat_array[2] = 'N';
            } else {
                lat_temp = e.latlng.lat * -1;
                lat_array = lat_temp.toFixed(5).split('.');
                lat_array[2] = 'S';
            }

            if (e.latlng.lng > 0) {
                if (parseInt(e.latlng.lng / 180) % 2 == 0) {

                    lng_temp = e.latlng.lng - parseInt(e.latlng.lng / 180) * 180;
                    lng_array = lng_temp.toFixed(5).split('.');
                    lng_array[2] = 'E';

                } else {
                    lng_temp = (parseInt(e.latlng.lng / 180) * 180 - e.latlng.lng) * -1;
                    lng_array = lng_temp.toFixed(5).split('.');
                    lng_array[2] = 'W';
                }
            } else {
                if (parseInt(e.latlng.lng / 180) % 2 == 0) {

                    lng_temp = (e.latlng.lng - parseInt(e.latlng.lng / 180) * 180) * -1;
                    lng_array = lng_temp.toFixed(5).split('.');
                    lng_array[2] = 'W';

                } else {
                    lng_temp = parseInt(e.latlng.lng / 180) * 180 - e.latlng.lng;
                    lng_array = lng_temp.toFixed(5).split('.');
                    lng_array[2] = 'E';
                }
            }

            window[e.type].innerHTML = lat_array[0].toString().concat('&deg').concat(lat_array[1].toString().concat('&prime;').concat(lat_array[2] + "  "))
            .concat(lng_array[0].toString().concat('&deg').concat(lng_array[1].toString().concat('&prime;').concat(lng_array[2])));

        });

        map.on('zoomend', function (e) {
            console.log(map.getZoom());
        });

        map.on('move', function () {
            // Construct an empty list to fill with onscreen markers.
            var inBounds = [],
            // Get the map bounds - the top-left and bottom-right locations.
                bounds = map.getBounds();

            // For each marker, consider whether it is currently visible by comparing
            // with the current map bounds.
            ships.eachLayer(function (marker) {
                if (bounds.contains(marker.getLatLng())) {
                    inBounds.push('M/V ' + marker.options.shipname);
                }
            });

            // Display a list of markers.
            document.getElementById('coordinates').innerHTML = inBounds.join('\n');
        });
    </script>
</body>
</html>